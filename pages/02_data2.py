import streamlit as st
import pandas as pd
import folium
from streamlit_folium import st_folium

# ì„±ë™êµ¬ ì£¼ìš” í–‰ì •ë™ë³„ ìœ„ë„/ê²½ë„ ì •ë³´ (ì˜ˆì‹œ)
dong_locations = {
    "ì™•ì‹­ë¦¬ë„ì„ ë™": [37.5631, 127.0365],
    "ë§ˆì¥ë™": [37.5663, 127.0414],
    "ì˜¥ìˆ˜ë™": [37.5469, 127.0155],
    "ê¸ˆí˜¸2.3ê°€ë™": [37.5487, 127.0212],
    "í–‰ë‹¹1ë™": [37.5594, 127.0436],
    "í–‰ë‹¹2ë™": [37.5551, 127.0373],
    "ì„±ìˆ˜1ê°€ì œ1ë™": [37.5454, 127.0551],
    "ì„±ìˆ˜1ê°€ì œ2ë™": [37.5444, 127.0583],
    "ì„±ìˆ˜2ê°€ì œ1ë™": [37.5415, 127.0507],
    "ì„±ìˆ˜2ê°€ì œ3ë™": [37.5440, 127.0483],
    "ê¸ˆí˜¸1ê°€ë™": [37.5473, 127.0275],
    "ì‘ë´‰ë™": [37.5601, 127.0342],
    "ì‚¬ê·¼ë™": [37.5576, 127.0431],
}

# CSV ë¶ˆëŸ¬ì˜¤ê¸°
@st.cache_data
def load_data():
    df = pd.read_csv("2024_2024_í–‰ì •ë™ë³„ ì„¸ëŒ€ì£¼ ì„±ì—°ë ¹ë³„ í˜„í™©_ì—°ê°„.csv", encoding="euc-kr")
    df["2024ë…„_ê±°ì£¼ì_ì´ì¸êµ¬ìˆ˜"] = df["2024ë…„_ê±°ì£¼ì_ì´ì¸êµ¬ìˆ˜"].str.replace(",", "").astype(int)
    df = df[df["í–‰ì •êµ¬ì—­"].str.contains("ì„±ë™êµ¬") & ~df["í–‰ì •êµ¬ì—­"].str.contains("ì„±ë™êµ¬ \\(")]  # ì „ì²´ ì œì™¸
    df["í–‰ì •ë™"] = df["í–‰ì •êµ¬ì—­"].str.extract(r"ì„±ë™êµ¬\s*(.*)\(")[0]
    df = df[["í–‰ì •ë™", "2024ë…„_ê±°ì£¼ì_ì´ì¸êµ¬ìˆ˜"]]
    return df

# ë°ì´í„° ë¡œë“œ
df = load_data()

# ì§€ë„ ìƒì„±
m = folium.Map(location=[37.5636, 127.0365], zoom_start=13)

# ë§ˆì»¤ ì¶”ê°€
for _, row in df.iterrows():
    dong = row["í–‰ì •ë™"]
    pop = row["2024ë…„_ê±°ì£¼ì_ì´ì¸êµ¬ìˆ˜"]
    coords = dong_locations.get(dong)
    if coords:
        folium.Marker(
            location=coords,
            popup=f"{dong}<br>ì´ì¸êµ¬ìˆ˜: {pop:,}",
            tooltip=f"{dong} ({pop:,}ëª…)",
            icon=folium.Icon(color="blue", icon="info-sign")
        ).add_to(m)

# Streamlit ì•±
st.title("ğŸ—º ì„±ë™êµ¬ í–‰ì •ë™ë³„ ì¸êµ¬ ë§ˆì»¤ ì§€ë„")
st.markdown("ì„±ë™êµ¬ ì£¼ìš” í–‰ì •ë™ì˜ ì´ì¸êµ¬ìˆ˜ë¥¼ **ì§€ë„ ìœ„ ë§ˆì»¤**ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.")
st.dataframe(df)  # ë°ì´í„° í™•ì¸
st_folium(m, width=700, height=500)
